{"ast":null,"code":"import _regeneratorRuntime from\"/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(LOGIN),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(LOAD_CURRENT_USER),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(rootSaga);import{all,takeEvery,put,call,select}from'redux-saga/effects';import*as userApis from\"../../services/users\";import actions from\"./actions\";import Cookies from'universal-cookie';export function LOGIN(_ref){var payload,email,password,response,cookies;return _regeneratorRuntime.wrap(function LOGIN$(_context){while(1){switch(_context.prev=_context.next){case 0:payload=_ref.payload;_context.next=3;return put({type:actions.SET_STATE,payload:{loading:false}});case 3:email=payload.email,password=payload.password;_context.next=6;return call(userApis.login,email,password);case 6:response=_context.sent;if(!response){_context.next=15;break;}cookies=new Cookies();cookies.set(\"x-auth-token\",response[\"x-auth-token\"],{maxAge:60*59,expires:response.expiresDate});_context.next=12;return put({type:actions.SET_STATE,payload:{loading:false}});case 12:window.location.reload(true);_context.next=17;break;case 15:_context.next=17;return put({type:actions.SET_STATE,payload:{loading:false,showErrorMessage:true,message:\"Email/mot de passe incorrect\"}});case 17:case\"end\":return _context.stop();}}},_marked);}export function LOAD_CURRENT_USER(){var response;return _regeneratorRuntime.wrap(function LOAD_CURRENT_USER$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return put({type:actions.SET_STATE,payload:{loadingCurrentUser:true}});case 2:_context2.next=4;return call(userApis.loadCurrentUser);case 4:response=_context2.sent;if(!response){_context2.next=10;break;}_context2.next=8;return put({type:actions.SET_STATE,payload:{loadingCurrentUser:false,authorized:true,user:response}});case 8:_context2.next=12;break;case 10:_context2.next=12;return put({type:actions.SET_STATE,payload:{loadingCurrentUser:false,authorized:false}});case 12:case\"end\":return _context2.stop();}}},_marked2);}export default function rootSaga(){return _regeneratorRuntime.wrap(function rootSaga$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return all([takeEvery(actions.LOGIN,LOGIN),LOAD_CURRENT_USER()]);case 2:case\"end\":return _context3.stop();}}},_marked3);}","map":{"version":3,"sources":["/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/src/redux/users/sagas.js"],"names":["LOGIN","LOAD_CURRENT_USER","rootSaga","all","takeEvery","put","call","select","userApis","actions","Cookies","payload","type","SET_STATE","loading","email","password","login","response","cookies","set","maxAge","expires","expiresDate","window","location","reload","showErrorMessage","message","loadingCurrentUser","loadCurrentUser","authorized","user"],"mappings":"mOAKiBA,K,iDA0BAC,iB,iDAmBQC,Q,EAlDzB,OAASC,GAAT,CAAcC,SAAd,CAAyBC,GAAzB,CAA8BC,IAA9B,CAAoCC,MAApC,KAAkD,oBAAlD,CACA,MAAO,GAAKC,CAAAA,QAAZ,KAA0B,sBAA1B,CACA,MAAOC,CAAAA,OAAP,KAAoB,WAApB,CACA,MAAOC,CAAAA,OAAP,KAAoB,kBAApB,CAEA,MAAO,SAAUV,CAAAA,KAAV,iKAAiBW,OAAjB,MAAiBA,OAAjB,iBACL,MAAMN,CAAAA,GAAG,CAAC,CACRO,IAAI,CAACH,OAAO,CAACI,SADL,CAERF,OAAO,CAAC,CAAEG,OAAO,CAAE,KAAX,CAFA,CAAD,CAAT,CADK,OAKEC,KALF,CAKqBJ,OALrB,CAKEI,KALF,CAKSC,QALT,CAKqBL,OALrB,CAKSK,QALT,iBAMY,MAAMV,CAAAA,IAAI,CAACE,QAAQ,CAACS,KAAV,CAAiBF,KAAjB,CAAwBC,QAAxB,CAAV,CANZ,OAMCE,QAND,mBAOFA,QAPE,0BAQGC,OARH,CAQa,GAAIT,CAAAA,OAAJ,EARb,CASHS,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4BF,QAAQ,CAAC,cAAD,CAApC,CAAqD,CACnDG,MAAM,CAAC,GAAK,EADuC,CAEnDC,OAAO,CAAEJ,QAAQ,CAACK,WAFiC,CAArD,EATG,iBAaH,MAAMlB,CAAAA,GAAG,CAAC,CACRO,IAAI,CAACH,OAAO,CAACI,SADL,CAERF,OAAO,CAAC,CAAEG,OAAO,CAAE,KAAX,CAFA,CAAD,CAAT,CAbG,QAiBHU,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuB,IAAvB,EAjBG,gDAmBH,MAAMrB,CAAAA,GAAG,CAAC,CACRO,IAAI,CAACH,OAAO,CAACI,SADL,CAERF,OAAO,CAAC,CAAEG,OAAO,CAAE,KAAX,CAAkBa,gBAAgB,CAAC,IAAnC,CAAyCC,OAAO,CAAC,8BAAjD,CAFA,CAAD,CAAT,CAnBG,uDA0BP,MAAO,SAAU3B,CAAAA,iBAAV,8JACL,MAAMI,CAAAA,GAAG,CAAC,CACRO,IAAI,CAAEH,OAAO,CAACI,SADN,CAERF,OAAO,CAAE,CAACkB,kBAAkB,CAAE,IAArB,CAFD,CAAD,CAAT,CADK,wBAKY,MAAMvB,CAAAA,IAAI,CAACE,QAAQ,CAACsB,eAAV,CAAV,CALZ,OAKCZ,QALD,oBAMDA,QANC,4CAOH,MAAMb,CAAAA,GAAG,CAAC,CACRO,IAAI,CAAEH,OAAO,CAACI,SADN,CAERF,OAAO,CAAC,CAAEkB,kBAAkB,CAAC,KAArB,CAA4BE,UAAU,CAAE,IAAxC,CAA8CC,IAAI,CAAEd,QAApD,CAFA,CAAD,CAAT,CAPG,yDAYH,MAAMb,CAAAA,GAAG,CAAC,CACRO,IAAI,CAAEH,OAAO,CAACI,SADN,CAERF,OAAO,CAAC,CAAEkB,kBAAkB,CAAC,KAArB,CAA4BE,UAAU,CAAE,KAAxC,CAFA,CAAD,CAAT,CAZG,yDAmBP,cAAe,SAAU7B,CAAAA,QAAV,wIACb,MAAMC,CAAAA,GAAG,CAAC,CACRC,SAAS,CAACK,OAAO,CAACT,KAAT,CAAgBA,KAAhB,CADD,CAERC,iBAAiB,EAFT,CAAD,CAAT,CADa","sourcesContent":["import { all, takeEvery, put, call, select } from 'redux-saga/effects'\nimport * as userApis from \"../../services/users\"\nimport actions from \"./actions\"\nimport Cookies from 'universal-cookie'\n\nexport function* LOGIN({payload}){\n  yield put({\n    type:actions.SET_STATE,\n    payload:{ loading: false}\n  })\n  const {email, password} = payload\n  const response = yield call(userApis.login, email, password);\n  if(response){\n    const cookies = new Cookies()\n    cookies.set(\"x-auth-token\", response[\"x-auth-token\"],{\n      maxAge:60 * 59,\n      expires: response.expiresDate\n    })\n    yield put({\n      type:actions.SET_STATE,\n      payload:{ loading: false }\n    })\n    window.location.reload(true)\n  }else{\n    yield put({\n      type:actions.SET_STATE,\n      payload:{ loading: false, showErrorMessage:true, message:\"Email/mot de passe incorrect\" }\n    })\n  }\n}\n\nexport function* LOAD_CURRENT_USER(){\n  yield put({\n    type: actions.SET_STATE,\n    payload: {loadingCurrentUser: true}\n  })\n  const response = yield call(userApis.loadCurrentUser)\n  if (response) {\n    yield put({\n      type: actions.SET_STATE,\n      payload:{ loadingCurrentUser:false, authorized: true, user: response }\n    })\n  }else{\n    yield put({\n      type: actions.SET_STATE,\n      payload:{ loadingCurrentUser:false, authorized: false }\n    })\n  }\n}\n\nexport default function* rootSaga() {\n  yield all([\n    takeEvery(actions.LOGIN, LOGIN),\n    LOAD_CURRENT_USER()\n  ])\n}\n"]},"metadata":{},"sourceType":"module"}