{"ast":null,"code":"import { all, takeEvery, put, call, select } from 'redux-saga/effects';\nimport * as userApis from \"../../services/users\";\nimport actions from \"./actions\";\nimport Cookies from 'universal-cookie';\nexport function* LOGIN({\n  payload\n}) {\n  const {\n    email,\n    password\n  } = payload;\n  const response = yield call(userApis.login, email, password);\n\n  if (response) {\n    const cookies = new Cookies();\n    cookies.set(\"x-auth-token\", response[\"x-auth-token\"], {\n      maxAge: 60 * 59,\n      expires: response.expiresDate\n    });\n    yield put({\n      type: actions.SET_STATE,\n      payload: {\n        loading: false\n      }\n    });\n    window.location.reload(true);\n  } else {\n    yield put({\n      type: actions.SET_STATE,\n      payload: {\n        loading: false,\n        showErrorMessage: true,\n        message: \"Email/mot de passe incorrect\"\n      }\n    });\n  }\n}\nexport function* LOAD_CURRENT_USER() {\n  yield put({\n    type: actions.SET_STATE,\n    payload: {\n      loadingCurrentUser: true\n    }\n  });\n  const response = yield call(userApis.loadCurrentUser);\n\n  if (response) {\n    yield put({\n      type: actions.SET_STATE,\n      payload: {\n        loadingCurrentUser: false,\n        authorized: true,\n        user: response\n      }\n    });\n  } else {\n    yield put({\n      type: actions.SET_STATE,\n      payload: {\n        loadingCurrentUser: false,\n        authorized: false\n      }\n    });\n  }\n}\nexport default function* rootSaga() {\n  yield all([takeEvery(actions.LOGIN, LOGIN), LOAD_CURRENT_USER()]);\n}","map":{"version":3,"sources":["/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano-frontend/src/redux/users/sagas.js"],"names":["all","takeEvery","put","call","select","userApis","actions","Cookies","LOGIN","payload","email","password","response","login","cookies","set","maxAge","expires","expiresDate","type","SET_STATE","loading","window","location","reload","showErrorMessage","message","LOAD_CURRENT_USER","loadingCurrentUser","loadCurrentUser","authorized","user","rootSaga"],"mappings":"AAAA,SAASA,GAAT,EAAcC,SAAd,EAAyBC,GAAzB,EAA8BC,IAA9B,EAAoCC,MAApC,QAAkD,oBAAlD;AACA,OAAO,KAAKC,QAAZ,MAA0B,sBAA1B;AACA,OAAOC,OAAP,MAAoB,WAApB;AACA,OAAOC,OAAP,MAAoB,kBAApB;AAEA,OAAO,UAAUC,KAAV,CAAgB;AAACC,EAAAA;AAAD,CAAhB,EAA0B;AAC/B,QAAM;AAACC,IAAAA,KAAD;AAAQC,IAAAA;AAAR,MAAoBF,OAA1B;AACA,QAAMG,QAAQ,GAAG,MAAMT,IAAI,CAACE,QAAQ,CAACQ,KAAV,EAAiBH,KAAjB,EAAwBC,QAAxB,CAA3B;;AACA,MAAGC,QAAH,EAAY;AACV,UAAME,OAAO,GAAG,IAAIP,OAAJ,EAAhB;AACAO,IAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4BH,QAAQ,CAAC,cAAD,CAApC,EAAqD;AACnDI,MAAAA,MAAM,EAAC,KAAK,EADuC;AAEnDC,MAAAA,OAAO,EAAEL,QAAQ,CAACM;AAFiC,KAArD;AAIA,UAAMhB,GAAG,CAAC;AACRiB,MAAAA,IAAI,EAACb,OAAO,CAACc,SADL;AAERX,MAAAA,OAAO,EAAC;AAAEY,QAAAA,OAAO,EAAE;AAAX;AAFA,KAAD,CAAT;AAIAC,IAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB,CAAuB,IAAvB;AACD,GAXD,MAWK;AACH,UAAMtB,GAAG,CAAC;AACRiB,MAAAA,IAAI,EAACb,OAAO,CAACc,SADL;AAERX,MAAAA,OAAO,EAAC;AAAEY,QAAAA,OAAO,EAAE,KAAX;AAAkBI,QAAAA,gBAAgB,EAAC,IAAnC;AAAyCC,QAAAA,OAAO,EAAC;AAAjD;AAFA,KAAD,CAAT;AAID;AACF;AAED,OAAO,UAAUC,iBAAV,GAA6B;AAClC,QAAMzB,GAAG,CAAC;AACRiB,IAAAA,IAAI,EAAEb,OAAO,CAACc,SADN;AAERX,IAAAA,OAAO,EAAE;AAACmB,MAAAA,kBAAkB,EAAE;AAArB;AAFD,GAAD,CAAT;AAIA,QAAMhB,QAAQ,GAAG,MAAMT,IAAI,CAACE,QAAQ,CAACwB,eAAV,CAA3B;;AACA,MAAIjB,QAAJ,EAAc;AACZ,UAAMV,GAAG,CAAC;AACRiB,MAAAA,IAAI,EAAEb,OAAO,CAACc,SADN;AAERX,MAAAA,OAAO,EAAC;AAAEmB,QAAAA,kBAAkB,EAAC,KAArB;AAA4BE,QAAAA,UAAU,EAAE,IAAxC;AAA8CC,QAAAA,IAAI,EAAEnB;AAApD;AAFA,KAAD,CAAT;AAID,GALD,MAKK;AACH,UAAMV,GAAG,CAAC;AACRiB,MAAAA,IAAI,EAAEb,OAAO,CAACc,SADN;AAERX,MAAAA,OAAO,EAAC;AAAEmB,QAAAA,kBAAkB,EAAC,KAArB;AAA4BE,QAAAA,UAAU,EAAE;AAAxC;AAFA,KAAD,CAAT;AAID;AACF;AAED,eAAe,UAAUE,QAAV,GAAqB;AAClC,QAAMhC,GAAG,CAAC,CACRC,SAAS,CAACK,OAAO,CAACE,KAAT,EAAgBA,KAAhB,CADD,EAERmB,iBAAiB,EAFT,CAAD,CAAT;AAID","sourcesContent":["import { all, takeEvery, put, call, select } from 'redux-saga/effects'\nimport * as userApis from \"../../services/users\"\nimport actions from \"./actions\"\nimport Cookies from 'universal-cookie'\n\nexport function* LOGIN({payload}){\n  const {email, password} = payload\n  const response = yield call(userApis.login, email, password);\n  if(response){\n    const cookies = new Cookies()\n    cookies.set(\"x-auth-token\", response[\"x-auth-token\"],{\n      maxAge:60 * 59,\n      expires: response.expiresDate\n    })\n    yield put({\n      type:actions.SET_STATE,\n      payload:{ loading: false }\n    })\n    window.location.reload(true)\n  }else{\n    yield put({\n      type:actions.SET_STATE,\n      payload:{ loading: false, showErrorMessage:true, message:\"Email/mot de passe incorrect\" }\n    })\n  }\n}\n\nexport function* LOAD_CURRENT_USER(){\n  yield put({\n    type: actions.SET_STATE,\n    payload: {loadingCurrentUser: true}\n  })\n  const response = yield call(userApis.loadCurrentUser)\n  if (response) {\n    yield put({\n      type: actions.SET_STATE,\n      payload:{ loadingCurrentUser:false, authorized: true, user: response }\n    })\n  }else{\n    yield put({\n      type: actions.SET_STATE,\n      payload:{ loadingCurrentUser:false, authorized: false }\n    })\n  }\n}\n\nexport default function* rootSaga() {\n  yield all([\n    takeEvery(actions.LOGIN, LOGIN),\n    LOAD_CURRENT_USER()\n  ])\n}\n"]},"metadata":{},"sourceType":"module"}