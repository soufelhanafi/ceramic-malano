{"ast":null,"code":"import _objectSpread from\"/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from\"react\";import{Modal,Form,Icon,Input,Button,Spin,Alert,Select,Row,Col,InputNumber}from'antd';import{connect}from\"react-redux\";import purchaseActions from\"../../../redux/purchase/actions\";import clientsActions from\"../../../redux/clients/actions\";import productActions from\"../../../redux/products/actions\";import{IdcardOutlined,PhoneOutlined}from'@ant-design/icons';import styles from\"./styles.module.scss\";var Option=Select.Option;var ClientModal=/*#__PURE__*/function(_React$Component){_inherits(ClientModal,_React$Component);var _super=_createSuper(ClientModal);function ClientModal(){var _this;_classCallCheck(this,ClientModal);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={client:{}};_this.handleCancel=function(e){e.preventDefault();_this.props.dispatch({type:purchaseActions.SET_STATE,payload:{showAddModal:false}});};_this.handleSubmit=function(e){e.preventDefault();var _this$props=_this.props,form=_this$props.form,dispatch=_this$props.dispatch;form.validateFields(function(error,values){if(!error){var _this$state=_this.state,client=_this$state.client,product=_this$state.product;var newPurchase={productId:product.id,productName:product.name,clientId:client.id,clientName:client.fullName};dispatch({type:purchaseActions.ADD_NEW_PURCHASE,payload:{newPurchase:_objectSpread(_objectSpread({},values),newPurchase)}});}});};_this.searchForClients=function(search){var _this$props$clients=_this.props.clients,size=_this$props$clients.size,page=_this$props$clients.page,sort=_this$props$clients.sort,order=_this$props$clients.order;_this.props.dispatch({type:clientsActions.LOAD_CLIENTS,payload:{size:size,page:page,sort:sort,order:order,search:search}});};_this.handleSearch=function(search){var _this$props$clients2=_this.props.clients,size=_this$props$clients2.size,page=_this$props$clients2.page,sort=_this$props$clients2.sort,order=_this$props$clients2.order;_this.props.dispatch({type:clientsActions.LOAD_CLIENTS,payload:{size:size,page:page,sort:sort,order:order,search:search}});};_this.onSelect=function(id){var clients=_this.props.clients.clients;for(var i=0;i<clients.length;i++){if(clients[i].id===id){_this.setState({client:clients[i]});_this.props.form.setFieldsValue({cine:clients[i].cine});}}};_this.handleSearchP=function(search){var _this$props$products=_this.props.products,size=_this$props$products.size,page=_this$props$products.page,sort=_this$props$products.sort,order=_this$props$products.order;_this.props.dispatch({type:productActions.LOAD_PRODUCTS,payload:{size:size,page:page,sort:sort,order:order,search:search}});};_this.onSelectP=function(id){var products=_this.props.products.products;for(var i=0;i<products.length;i++){if(products[i].id===id){_this.setState({product:products[i]});_this.props.form.setFieldsValue({unitPrice:products[i].unitPrice});}}};_this.calculePurchase=function(num){var unitPrice=_this.props.form.getFieldValue(\"unitPrice\");if(unitPrice){var totalPrice=num*unitPrice;_this.props.form.setFieldsValue({totalPrice:totalPrice,totalPaid:totalPrice,remainingAmount:0});}};_this.changeUnitPrice=function(up){var totalPrice=_this.props.form.getFieldValue(\"totalPrice\");var numberOfUnity=_this.props.form.getFieldValue(\"numberOfUnity\");if(totalPrice>=0&&numberOfUnity>=0){var total=up*numberOfUnity;_this.props.form.setFieldsValue({totalPrice:total,totalPaid:total,remainingAmount:0});}};_this.calculRemainingAmout=function(amount){debugger;var remainingAmount=_this.props.form.getFieldValue(\"totalPrice\")-amount;_this.props.form.setFieldsValue({remainingAmount:remainingAmount});};return _this;}_createClass(ClientModal,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props$products2=this.props.products,size=_this$props$products2.size,page=_this$props$products2.page,sort=_this$props$products2.sort,order=_this$props$products2.order;this.props.dispatch({type:productActions.LOAD_PRODUCTS,payload:{size:size,page:page,sort:sort,order:order}});}},{key:\"render\",value:function render(){var _this2=this;var getFieldDecorator=this.props.form.getFieldDecorator;var _this$props$purchases=this.props.purchases,loading=_this$props$purchases.loading,showErrorMessage=_this$props$purchases.showErrorMessage,message=_this$props$purchases.message,showAddModal=_this$props$purchases.showAddModal;var clients=this.props.clients.clients;var products=this.props.products.products;var options=clients.map(function(d,index){return/*#__PURE__*/React.createElement(Option,{key:index,value:d.id},d.fullName);});var optionsP=products.map(function(d,index){return/*#__PURE__*/React.createElement(Option,{key:index,value:d.id},d.name);});return/*#__PURE__*/React.createElement(Modal,{title:\"Ajout un achat\",visible:showAddModal,width:700,onOk:this.handleOk,onCancel:this.handleCancel,footer:null,destroyOnClose:true},/*#__PURE__*/React.createElement(Spin,{spinning:loading,tip:\"Loading...\"},showErrorMessage&&/*#__PURE__*/React.createElement(Alert,{message:message,type:\"error\",banner:true}),/*#__PURE__*/React.createElement(Form,{onSubmit:this.handleSubmit,className:\"login-form\"},/*#__PURE__*/React.createElement(Form.Item,{label:\"R\\xE9f\\xE9rence\"},getFieldDecorator('reference',{rules:[{required:true,message:'Référence Obligatoire!'}]})(/*#__PURE__*/React.createElement(Input,null))),/*#__PURE__*/React.createElement(Row,{type:\"flex\",justify:\"space-between\"},/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"Client\"},getFieldDecorator('client',{rules:[{required:true,message:\"Client obligatoire\"}]})(/*#__PURE__*/React.createElement(Select,{showSearch:true,defaultActiveFirstOption:false,showArrow:false,filterOption:false,onSearch:this.handleSearch,onSelect:this.onSelect,notFoundContent:null},options)))),/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"CINE\"},getFieldDecorator('cine',{rules:[{required:true,message:'CINE Obligatoire!'}]})(/*#__PURE__*/React.createElement(Input,{disabled:true,prefix:/*#__PURE__*/React.createElement(IdcardOutlined,{style:{color:'rgba(0,0,0,.25)'}})}))))),/*#__PURE__*/React.createElement(Row,{type:\"flex\",justify:\"space-between\"},/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"Produit\"},getFieldDecorator('product',{rules:[{required:true,message:\"Produit obligatoire\"}]})(/*#__PURE__*/React.createElement(Select,{showSearch:true,defaultActiveFirstOption:false,showArrow:false,filterOption:false,onSearch:this.handleSearchP,onSelect:this.onSelectP,notFoundContent:null},optionsP)))),/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"Prix d'unit\\xE9\"},getFieldDecorator('unitPrice',{rules:[{required:true,message:'Prix d\\'unité Obligatoire!'}]})(/*#__PURE__*/React.createElement(InputNumber,{onChange:function onChange(up){return _this2.changeUnitPrice(up);}}))))),/*#__PURE__*/React.createElement(Row,{type:\"flex\",justify:\"space-between\"},/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"Nombre d'unit\\xE9\"},getFieldDecorator('numberOfUnity',{initialValue:0,rules:[{required:true,message:\"Nombre d'unité obligatoire\"}]})(/*#__PURE__*/React.createElement(InputNumber,{onChange:function onChange(e){return _this2.calculePurchase(e);},min:0})))),/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"Prix Total\"},getFieldDecorator('totalPrice',{initialValue:0,rules:[{required:true,message:'Prix d\\'unité Obligatoire!'}]})(/*#__PURE__*/React.createElement(InputNumber,{disabled:true}))))),/*#__PURE__*/React.createElement(Row,{type:\"flex\",justify:\"space-between\"},/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"Montant pay\\xE9\"},getFieldDecorator('totalPaid',{initialValue:0,rules:[{required:true,message:\"Montant payé obligatoire\"}]})(/*#__PURE__*/React.createElement(InputNumber,{min:0,onChange:function onChange(am){return _this2.calculRemainingAmout(am);}})))),/*#__PURE__*/React.createElement(Col,{span:11},/*#__PURE__*/React.createElement(Form.Item,{label:\"Montant Restant\"},getFieldDecorator('remainingAmount',{initialValue:0})(/*#__PURE__*/React.createElement(InputNumber,{min:0}))))),/*#__PURE__*/React.createElement(\"div\",{className:styles.footer},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{type:\"primary\",htmlType:\"submit\"},\"Valider\")),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{onClick:this.handleCancel},\"Annuler\"))))));}}]);return ClientModal;}(React.Component);var mapStateToProps=function mapStateToProps(state){return state;};var WrappedClientModalForm=Form.create({name:'add_client_modal'})(ClientModal);export default connect(mapStateToProps)(WrappedClientModalForm);","map":{"version":3,"sources":["/Users/soufelhanafi/souf-projects/fl/bachir/ceramic-milano/frontend/src/pages/purchase/purchaseModal/index.js"],"names":["React","Modal","Form","Icon","Input","Button","Spin","Alert","Select","Row","Col","InputNumber","connect","purchaseActions","clientsActions","productActions","IdcardOutlined","PhoneOutlined","styles","Option","ClientModal","state","client","handleCancel","e","preventDefault","props","dispatch","type","SET_STATE","payload","showAddModal","handleSubmit","form","validateFields","error","values","product","newPurchase","productId","id","productName","name","clientId","clientName","fullName","ADD_NEW_PURCHASE","searchForClients","search","clients","size","page","sort","order","LOAD_CLIENTS","handleSearch","onSelect","i","length","setState","setFieldsValue","cine","handleSearchP","products","LOAD_PRODUCTS","onSelectP","unitPrice","calculePurchase","num","getFieldValue","totalPrice","totalPaid","remainingAmount","changeUnitPrice","up","numberOfUnity","total","calculRemainingAmout","amount","getFieldDecorator","purchases","loading","showErrorMessage","message","options","map","d","index","optionsP","handleOk","rules","required","color","initialValue","am","footer","Component","mapStateToProps","WrappedClientModalForm","create"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport { Modal, Form, Icon, Input, Button, Spin, Alert, Select, Row, Col, InputNumber } from 'antd';\nimport { connect } from \"react-redux\"\nimport purchaseActions from \"../../../redux/purchase/actions\"\nimport clientsActions from \"../../../redux/clients/actions\"\nimport productActions from \"../../../redux/products/actions\"\nimport { IdcardOutlined, PhoneOutlined } from '@ant-design/icons';\nimport styles from \"./styles.module.scss\"\n\nconst { Option } = Select;\n\nclass ClientModal extends React.Component {\n  state = {\n    client:{}\n  }\n\n  componentDidMount(){\n    const {size, page, sort, order} = this.props.products\n    this.props.dispatch({\n      type: productActions.LOAD_PRODUCTS,\n      payload:{size, page, sort, order}\n    })\n  }\n\n  handleCancel = e =>{\n    e.preventDefault()\n    this.props.dispatch({\n      type:purchaseActions.SET_STATE,\n      payload: {showAddModal: false}\n    })\n  }\n\n  handleSubmit = e=>{\n    e.preventDefault()\n    const { form, dispatch } = this.props\n    form.validateFields((error, values) => {\n      if(!error){\n        const {client, product} = this.state\n        const newPurchase = {\n          productId: product.id,\n          productName: product.name,\n          clientId: client.id,\n          clientName: client.fullName,\n        }\n        dispatch({\n          type: purchaseActions.ADD_NEW_PURCHASE,\n          payload: {newPurchase:{...values,...newPurchase}}\n        })\n      }\n    })\n  }\n\n  searchForClients = search=>{\n    const {size, page, sort, order} = this.props.clients\n    this.props.dispatch({\n      type: clientsActions.LOAD_CLIENTS,\n      payload:{size, page, sort, order, search}\n    })\n  }\n\n  handleSearch = search => {\n    const {size, page, sort, order} = this.props.clients\n    this.props.dispatch({\n      type: clientsActions.LOAD_CLIENTS,\n      payload:{size, page, sort, order, search}\n    })\n  };\n\n  onSelect = id => {\n    const {clients} = this.props.clients\n    for(let i = 0; i<clients.length; i++){\n      if(clients[i].id === id){\n        this.setState({client:clients[i]})\n        this.props.form.setFieldsValue({cine:clients[i].cine})\n      }\n    }\n  }\n\n  handleSearchP = search => {\n    const {size, page, sort, order} = this.props.products\n    this.props.dispatch({\n      type: productActions.LOAD_PRODUCTS,\n      payload:{size, page, sort, order, search}\n    })\n  };\n\n  onSelectP = id => {\n    const {products} = this.props.products\n    for(let i = 0; i<products.length; i++){\n      if(products[i].id === id){\n        this.setState({product:products[i]})\n        this.props.form.setFieldsValue({unitPrice: products[i].unitPrice})\n      }\n    }\n  }\n\n  calculePurchase = num =>{\n    const unitPrice = this.props.form.getFieldValue(\"unitPrice\")\n    if(unitPrice){\n      const totalPrice = num * unitPrice\n      this.props.form.setFieldsValue({totalPrice,totalPaid:totalPrice,remainingAmount:0})\n    }\n  }\n\n  changeUnitPrice = up => {\n    const totalPrice = this.props.form.getFieldValue(\"totalPrice\")\n    const numberOfUnity = this.props.form.getFieldValue(\"numberOfUnity\")\n    if(totalPrice>=0 && numberOfUnity>=0){\n      const total = up * numberOfUnity\n      this.props.form.setFieldsValue({totalPrice:total,totalPaid:total,remainingAmount:0})\n    }\n  }\n\n  calculRemainingAmout = amount =>{\n    debugger\n    const remainingAmount = this.props.form.getFieldValue(\"totalPrice\") - amount\n    this.props.form.setFieldsValue({remainingAmount})\n  }\n\n  render(){\n    const { getFieldDecorator } = this.props.form;\n    const {loading, showErrorMessage, message, showAddModal} = this.props.purchases\n    const { clients } = this.props.clients\n    const { products } = this.props.products\n    const options = clients.map((d,index) => <Option key={index} value={d.id}>{d.fullName}</Option>);\n    const optionsP = products.map((d,index) => <Option key={index} value={d.id}>{d.name}</Option>);\n    return (\n      <Modal\n        title=\"Ajout un achat\"\n        visible={showAddModal}\n        width={700}\n        onOk={this.handleOk}\n        onCancel={this.handleCancel}\n        footer={null}\n        destroyOnClose={true}\n      >\n        <Spin spinning={loading} tip=\"Loading...\">\n        {showErrorMessage&&<Alert message={message} type=\"error\" banner />}\n          <Form onSubmit={this.handleSubmit} className=\"login-form\">\n            <Form.Item label=\"Référence\">\n              {getFieldDecorator('reference', {\n                rules: [{ required: true, message: 'Référence Obligatoire!' }],\n              })(\n                <Input />,\n              )}\n            </Form.Item>\n            <Row type=\"flex\" justify=\"space-between\" >\n              <Col span={11}>\n                <Form.Item label=\"Client\">\n                  {getFieldDecorator(\n                    'client',\n                    {rules:[\n                      { required: true, message: \"Client obligatoire\" },\n                    ]},\n                  )(\n                    <Select\n                      showSearch\n                      defaultActiveFirstOption={false}\n                      showArrow={false}\n                      filterOption={false}\n                      onSearch={this.handleSearch}\n                      onSelect={this.onSelect}\n                      notFoundContent={null}\n                    >\n                      {options}\n                    </Select>,\n                  )}\n                </Form.Item>\n              </Col>\n              <Col span={11}>\n                <Form.Item label=\"CINE\">\n                  {getFieldDecorator('cine', {\n                    rules: [{ required: true, message: 'CINE Obligatoire!' }],\n                  })(\n                    <Input\n                      disabled\n                      prefix={<IdcardOutlined style={{ color: 'rgba(0,0,0,.25)' }} />}\n                    />,\n                  )}\n                </Form.Item>\n              </Col>\n            </Row>\n            <Row type=\"flex\" justify=\"space-between\" >\n              <Col span={11}>\n                <Form.Item label=\"Produit\">\n                  {getFieldDecorator(\n                    'product',\n                    {rules:[\n                      { required: true, message: \"Produit obligatoire\" },\n                    ]},\n                  )(\n                    <Select\n                      showSearch\n                      defaultActiveFirstOption={false}\n                      showArrow={false}\n                      filterOption={false}\n                      onSearch={this.handleSearchP}\n                      onSelect={this.onSelectP}\n                      notFoundContent={null}\n                    >\n                      {optionsP}\n                    </Select>,\n                  )}\n                </Form.Item>\n              </Col>\n              <Col span={11}>\n                <Form.Item label=\"Prix d'unité\">\n                  {getFieldDecorator('unitPrice', {\n                    rules: [{ required: true, message: 'Prix d\\'unité Obligatoire!' }],\n                  })(\n                    <InputNumber onChange={up=>this.changeUnitPrice(up)} />,\n                  )}\n                </Form.Item>\n              </Col>\n            </Row>\n            <Row type=\"flex\" justify=\"space-between\" >\n              <Col span={11}>\n                <Form.Item label=\"Nombre d'unité\">\n                  {getFieldDecorator(\n                    'numberOfUnity',\n                    {\n                      initialValue:0,\n                      rules:[\n                      { required: true, message: \"Nombre d'unité obligatoire\" },\n                    ]},\n                  )(\n                    <InputNumber onChange={e=>this.calculePurchase(e)} min={0} />,\n                  )}\n                </Form.Item>\n              </Col>\n              <Col span={11}>\n                <Form.Item label=\"Prix Total\">\n                  {getFieldDecorator('totalPrice', {\n                    initialValue:0,\n                    rules: [{ required: true, message: 'Prix d\\'unité Obligatoire!' }],\n                  })(\n                    <InputNumber disabled />,\n                  )}\n                </Form.Item>\n              </Col>\n            </Row>\n            <Row type=\"flex\" justify=\"space-between\" >\n              <Col span={11}>\n                <Form.Item label=\"Montant payé\">\n                  {getFieldDecorator(\n                    'totalPaid',\n                    {\n                      initialValue:0,\n                      rules:[\n                      { required: true, message: \"Montant payé obligatoire\" },\n                    ]},\n                  )(\n                    <InputNumber min={0} onChange={am=>this.calculRemainingAmout(am)}  />,\n                  )}\n                </Form.Item>\n              </Col>\n              <Col span={11}>\n                <Form.Item label=\"Montant Restant\">\n                  {getFieldDecorator('remainingAmount', {\n                    initialValue:0,\n                  })(\n                    <InputNumber min={0} />,\n                  )}\n                </Form.Item>\n              </Col>\n            </Row>\n\n            <div className={styles.footer}>\n              <div>\n                <Button type=\"primary\" htmlType=\"submit\">\n                  Valider\n                </Button>\n              </div>\n              <div>\n                <Button onClick={this.handleCancel}>Annuler</Button>\n              </div>\n            </div>\n          </Form>\n        </Spin>\n      </Modal>\n    )\n  }\n}\n\nconst mapStateToProps = state=>{\n  return state\n}\n\nconst WrappedClientModalForm = Form.create({ name: 'add_client_modal' })(ClientModal);\n\nexport default connect(mapStateToProps)(WrappedClientModalForm)\n"]},"metadata":{},"sourceType":"module"}